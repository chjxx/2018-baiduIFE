!function(t){var e={};function n(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);n(1);var a=[{product:"手机",region:"华东",sale:[120,100,140,160,180,185,190,210,230,245,255,270]},{product:"手机",region:"华北",sale:[80,70,90,110,130,145,150,160,170,185,190,200]},{product:"手机",region:"华南",sale:[220,200,240,250,260,270,280,295,310,335,355,380]},{product:"笔记本",region:"华东",sale:[50,60,80,110,30,20,70,30,420,30,20,20]},{product:"笔记本",region:"华北",sale:[30,35,50,70,20,15,30,50,710,130,20,20]},{product:"笔记本",region:"华南",sale:[80,120,130,140,70,75,120,90,550,120,110,100]},{product:"智能音箱",region:"华东",sale:[10,30,4,5,6,5,4,5,6,5,5,25]},{product:"智能音箱",region:"华北",sale:[15,50,15,15,12,11,11,12,12,14,12,40]},{product:"智能音箱",region:"华南",sale:[10,40,10,6,5,6,8,6,6,6,7,26]}];const i={region:"地区",product:"商品"},r=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];class s{constructor(t){let e=localStorage.getItem("dataModel");e?this.data=JSON.parse(e):(localStorage.setItem("dataModel",t),this.data=JSON.parse(t))}getOptionsData(){return this.optsObj=this.data.reduce((t,e)=>{for(let n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)?-1===t[n].options.indexOf(e[n])&&t[n].options.push(e[n]):"sale"!==n&&(t[n]={},t[n].options=[e[n]],t[n].title=i[n]?i[n]:""));return t},{}),this.optsObj}searchData(t){let e=this;for(let e in t)if(t.hasOwnProperty(e)&&0===t[e].length)return;return 1===t.region.length?n([e.data,t,["region","product"]]):n([e.data,t,["product","region"]]);function n([t,e,n]){let a={};return a.title=n.reduce((t,e)=>(t.push(i[e]?i[e]:e),t),[]).concat(r),a.body=[],function t({orderIdx:a=0,ctArr:i,data:r}){e[n[a]].forEach(e=>{let s={name:n[a],val:e};if(a===n.length-1){let t=r.find(t=>t[n[a]]===e);s.sale=t.sale,i.push(s)}else{s.options=[],i.push(s);let o=r.filter(t=>t[n[a]]===e);t({orderIdx:a+1,ctArr:s.options,data:o})}})}({ctArr:a.body,data:t}),a}}updateData(t){t.category.reduce((e,n,a)=>{let r;for(let t in i)i.hasOwnProperty(t)&&i[t]===n[0]&&(r=t);if(a!==t.category.length-1)return e.filter(t=>t[r]===n[1]);e.find(t=>t[r]===n[1]).sale=t.chunk.concat()},this.data),localStorage.setItem("dataModel",JSON.stringify(this.data))}}const o={title:"title",checkAll:"check-all",checkAllChosen:"check-all_chosen",option:"option",optionChosen:"option_chosen"};class l{constructor(t){this.$container=document.querySelector(t),this.addEventListener(),this.handler=[]}render(t){this.optsObj=t;for(let n in t)t.hasOwnProperty(n)&&(this.$container.innerHTML=this.$container.innerHTML+e(t,n));function e(t,e){return`<div class="${e}">\n\t\t\t\t<p class="${o.title}">${t[e].title}</p>\n\t\t\t\t<a href="javascript:;" class="${o.checkAll}" data-class-trigger="${o.checkAllChosen}">全选</a>\n\t\t\t\t${function(t){return t.reduce((t,e)=>t+`<a href="javascript:;" class="${o.option}" data-class-trigger="${o.optionChosen}">${e}</a>`,"")}(t[e].options)}\n\t\t\t</div>`}}addEventListener(){let t=this;this.$container.addEventListener("click",e=>{let n=e.target;if("A"===n.tagName){let e=n.parentNode,i=n.className;if(-1!==i.indexOf(o.checkAll)){if(i===o.checkAll){let i=e.querySelectorAll("."+o.option);a(n),Array.from(i).forEach(t=>{a(t)}),t.emit("changed",t)}}else if(i===o.optionChosen){let i=e.querySelector("."+o.checkAllChosen);if(1===e.querySelectorAll("."+o.optionChosen).length)return;a(n),i&&a(i),t.emit("changed",t)}else{a(n);let i=e.querySelectorAll("."+o.option),r=e.querySelector("."+o.checkAll);0===i.length&&a(r),t.emit("changed",t)}}function a(t){let e=t.dataset.classTrigger;t.dataset.classTrigger=t.className,t.className=e}})}getChosenOptionsData(){let t=this.$container.querySelectorAll("div");return Array.from(t).reduce((t,e)=>{let n=e.querySelectorAll("."+o.optionChosen),a=Array.from(n).reduce((t,e)=>(t.push(e.innerText.trim()),t),[]);return t[e.className]=a,t},{})}watch(t,...e){this.handler[t]||(this.handler[t]=[]),this.handler[t].push(...e)}emit(t,e){this.handler[t]&&this.handler[t].forEach(t=>t(e))}}class c{constructor(t){this.$container=document.querySelector(t),this.$tips=this.$container.querySelector(".tips"),this.$content=this.$container.querySelector(".wrapper"),this.$tips.innerText="请输入纯数字!!",this.$content.innerHTML="选项不足!",this.handler=[]}render(t){t?(this.$content.innerHTML=`<table>\n        <thead><tr>${function(t){return t.reduce((t,e)=>t+`<th>${e}</th>`,"")}(t.title)}</tr></thead>\n        <tbody>${function(t){return function t({data:e,root:n,head:a}){if(e instanceof Array)return e.reduce((e,i,r)=>e+t({data:i,head:a=!!n||0!==r}),"");if(a){if(e.options instanceof Array)return`<tr><th rowspan="${e.options.length}">${e.val}</th>${t({data:e.options})}</tr>`;if(e.sale instanceof Array)return`<tr><th>${e.val}</th>${e.sale.reduce((t,e)=>`${t}<td><span contentEditable='true'>${e}</span><i class="edit"></i></td>`,"")}</tr>`}else{if(e.options instanceof Array)return`<th rowspan="${e.options.length}">${e.val}</th>${t({data:e.options})}`;if(e.sale instanceof Array)return`<th>${e.val}</th>${e.sale.reduce((t,e)=>`${t}<td><span contentEditable='true'>${e}</span><i class="edit"></i></td>`,"")}`}}({data:t,root:!0})}(t.body)}</tbody>\n      </table>`,this.$table=this.$content.querySelector("table"),this.emit("rendered",this),this.addEvent()):this.$content.innerHTML="选项不足!"}addEvent(){let t,e=this,n=/^[1-9][0-9]*$/;this.$table.addEventListener("mouseover",t=>{e.emit("mouseover",t,e)}),this.$table.addEventListener("mouseout",t=>{e.emit("mouseout",t,e)}),this.$table.addEventListener("click",t=>{if("I"===t.target.tagName){let e=t.target,n=e.parentNode.querySelector("span");e.classList.contains("edit")?n.focus():e.classList.contains("finish")&&n.blur()}}),this.$table.addEventListener("focus",e=>{let n=e.target,a=n.parentNode.querySelector("i");a.classList.contains("edit")&&(a.classList.remove("edit"),a.classList.add("finish")),t=n.innerText.trim()},!0),this.$table.addEventListener("blur",a=>{let i=a.target,r=i.innerText.trim();if(n.test(r)){let n=a.target.parentNode.querySelector("i");if(n.classList.contains("finish")&&(n.classList.remove("finish"),n.classList.add("edit")),t!==i.innerText.trim()){let t=function t(e,n){if(e){if(e.tagName!==n){let a=e.parentNode;return t(a,n)}return e}}(a.target,"TR"),n=e.getRowData(t);e.emit("changed",n,e)}}else i.focus(),function(t,e=5e3){let n=new Date;requestAnimationFrame(function a(){let i=new Date,r=1-(i-n)/e;"block"!==t.style.display&&(t.style.display="block"),t.style.opacity=r,r<=0?t.style.display="none":requestAnimationFrame(a)})}(e.$tips,3e3)},!0),this.$table.addEventListener("keydown",t=>{if("Enter"===t.key||"Escape"===t.key){t.target.blur(),t.preventDefault()}})}watch(t,...e){this.handler[t]||(this.handler[t]=[]),this.handler[t].push(...e)}emit(t,...e){this.handler[t]&&this.handler[t].forEach(t=>t(...e))}getRowData(t){let e=this,n=t.querySelectorAll("td"),a=function(t){if(t.length)return Array.from(t).reduce((t,e)=>{let n=Number.parseFloat(e.innerText.trim());return t.push(Number.isNaN(n)?0:n),t},[])}(n),i={category:function(t,n){let a=e.$table.querySelectorAll("thead th"),i=a.length,r=t.querySelectorAll("td").length;return function t(e,n,r=[]){let s=e.children.length;if(s>n){let t=s-n;for(let n=1;n<=t;n++)r.unshift(e.children[t-n].innerText.trim())}return i===s?r.reduce((t,e,n)=>{let i=a[n].innerText.trim();return t.push([i,e]),t},[]):t(e.previousElementSibling,s,r)}(t,r)}(t,n.length),chunk:a};return i}getTableData(){let t=this.$table.querySelectorAll("tbody tr");return Array.from(t).map(t=>this.getRowData(t),this)}}let h={axis:{basePoint:[100,350],x:{line:{},text:{}},y:{line:{length:250,partCount:5,distribut:"endpoint"},text:{}}},bar:{width:40},category:{basePoint:[650,40]}};const d=[5,10,20,50,100,200,300];class u{constructor(t,e){this.$container=document.querySelector(t),h=Object.assign(h,e)}render(t){this.evaluat(t),this.$container.innerHTML=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">\n      ${this.generateAxis(t)}\n      ${this.generateBar(t)}\n      ${this.generateCategory(t)}\n    </svg`}evaluat(t){!function(t){let e=t.chunk.concat().sort((t,e)=>e-t)[0],n=h.axis.y.line.partCount,a=h.axis.y.line.length,i=e/n,r=d.find(t=>i<=t);h.axis.y.line.partScaleLength=r,h.bar.scale=a/n/r}(t),function(t){h.axis.x.line.partCount=t.chunk.length+1,h.axis.x.line.partLength=h.bar.width+10,h.axis.x.line.length=h.axis.x.line.partCount*h.axis.x.line.partLength}(t),function(t){let e={length:t.chunk.length},n=h.axis.x.line.partLength;if(h.axis.x.line.markPoint=Array.from(e).map((t,e)=>[h.axis.basePoint[0]+(e+1)*n,h.axis.basePoint[1]]),"endpoint"===h.axis.y.line.distribut){let t=h.axis.y.line.partCount+1,e={length:t},n=h.axis.y.line.length/h.axis.y.line.partCount;h.axis.y.line.markPoint=Array.from(e).map((t,e)=>{let a=h.axis.basePoint[1]-n*e;return[h.axis.basePoint[0],a]})}}(t),"endpoint"===h.axis.y.line.distribut&&(h.axis.y.line.dashedLine=h.axis.y.line.markPoint.reduce((t,e,n)=>(0!==n&&t.push([...e,h.axis.x.line.length]),t),[])),h.axis.y.text.data=h.axis.y.line.markPoint.map((t,e)=>{let n=h.axis.y.line.partScaleLength*e;return[t[0]-10,t[1]+5,n]}),h.axis.x.text.data=h.axis.x.line.markPoint.map((t,e)=>{let n=e+1+"月";return[t[0],t[1]+30,n]}),function(t){let e=-h.bar.width/2;h.bar.data=t.chunk.map((t,n)=>{let a=h.axis.x.line.markPoint[n],i=h.bar.scale*t,r=a[1]-h.bar.scale*t,s=a[0]+e;return[s,r,i]})}(t),function(t){let e=t.category;h.category.data=e.reduce((t,e,n)=>{let a=h.category.basePoint[0],i=h.category.basePoint[1]+25*n;return t.push([a,i,e]),t},[])}(t)}generateAxis(t){return function(t){let e=`M${h.axis.basePoint.join(" ")}`;return`<path class="axis-line" d="${`${e} v ${-h.axis.y.line.length} ${e} h ${h.axis.x.line.length}`+function(){let t="";return t+=h.axis.y.line.markPoint.reduce((t,e)=>`${t} M${e.join(" ")} h -5`,""),t+=h.axis.x.line.markPoint.reduce((t,e)=>`${t} M${e.join(" ")} v 5`,"")}()}"\n      ></path>${function(){return`<path class="axis-dashed-line" d="${h.axis.y.line.dashedLine.reduce((t,e,n)=>t+=`M${e.slice(0,2).join(" ")} h ${e[2]} `,"")}"></path>`}()}`}()+function(t){return`<text class="x-axis-text">\n        ${h.axis.x.text.data.reduce((t,e)=>`${t}<tspan x="${e[0]}" y="${e[1]}" text-anchor="middle">${e[2]}</tspan>`,"")}\n        </text>`+`<text class="y-axis-text">\n        ${h.axis.y.text.data.reduce((t,e)=>`${t}<tspan x="${e[0]}" y="${e[1]}" text-anchor="end">${e[2]}</tspan>`,"")}\n        </text>`}()}generateBar(){return`<g>\n      ${h.bar.data.reduce((t,e)=>`${t}<rect class="chart-bar" x="${e[0]}" y="${e[1]}" height="${e[2]-.5}" width="${h.bar.width}"></rect>`,"")}\n    </g>`}generateCategory(){return`<text class="category">\n      ${h.category.data.reduce((t,e)=>`${t}<tspan x="${e[0]}" y="${e[1]}" text-anchor="start">${e[2].join(": ")}</tspan>`,"")}\n    </text>`}}const x=800,g=400;let f={axis:{basePoint:[65,350],x:{line:{length:550,partCount:11,distribut:"both"},text:{}},y:{line:{length:250,partCount:5,distribut:"both"},text:{}}},line:{},category:{basePoint:[645,40],attrWidth:75,attrHeight:40,textOffset:-45,colorBoxWidth:20}};const p=[5,10,20,50,100,200,300],y=["IndianRed","LawnGreen","RosyBrown","Chocolate","Maroon","DarkGreen","DarkRed","MediumVioletRed","DarkOrange","DarkCyan","SteelBlue","Magenta","Navy","MediumSlateBlue"];class m{constructor(t){this.$container=document.querySelector(t)}render(t){let e=$(`<canvas class="base-axis" width="${x}" height="${g}"></canvas>`);""!==this.$container.innerHTML&&(this.$container.innerHTML=""),this.$container.appendChild(e),this.ctx=e.getContext("2d"),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,x,g),this.data=t,this.evaluate(t),this.generateAxis(),this.generateLines(),this.generateCategory()}evaluate(t){!function(t){let e=t.map((t,e)=>{let n=t.chunk.concat();return n.sort((t,e)=>e-t),n[0]}).sort((t,e)=>e-t)[0]/f.axis.y.line.partCount,n=p.find(t=>e<t);f.axis.y.line.partScaleLength=n,f.line.scale=f.axis.y.line.length/f.axis.y.line.partCount/n}(t),function(){(function(){if("both"===f.axis.x.line.distribut){let t=f.axis.x.line.partCount+1,e={length:t},n=f.axis.x.line.length/f.axis.x.line.partCount;f.axis.x.line.markPoint=Array.from(e).map((t,e)=>[e*n,0])}})(),function(){if("both"===f.axis.y.line.distribut){let t=f.axis.y.line.partCount+1,e={length:t},n=f.axis.y.line.length/f.axis.y.line.partCount;f.axis.y.line.markPoint=Array.from(e).map((t,e)=>[0,0-e*n])}}()}(),function(t){(function(t){let e=f.axis.x.line,n=0;"both"===e.distribut&&(n=1);f.axis.x.text=e.markPoint.map((t,e)=>{let a=e+n+"月",i=t[0],r=t[1]+30;return[a,i,r]})})(),function(t){let e=f.axis.y.line,n=0;"middle"===e.distribut&&(n=1);f.axis.y.text=e.markPoint.map((t,e)=>{let a=(e+n)*f.axis.y.line.partScaleLength,i=t[0]-10,r=t[1]+5;return[a,i,r]})}()}(),f.axis.y.line.dashedLine=f.axis.y.line.markPoint.reduce((t,e,n)=>{if(0===e[0]&&0===e[1])return t;{let n=[f.axis.x.line.length,e[1]];return t.push([e,n]),t}},[]),function(t){let e=f.axis.x.line.markPoint;t.forEach((t,n)=>{let a=t.chunk;t.chunkPositions=a.map((t,n)=>{let a=e[n][0],i=0-f.line.scale*t;return[a,i]}),t.lineColor=y[n]})}(t),function(t){let e=f.category.attrWidth,n=f.category.attrHeight,a=f.category.textOffset;t.forEach((t,i)=>{let r=i*n,s=[0,r];t.categoryPositions=[[s,t.lineColor]],t.category.forEach((n,i)=>{let s=(i+1)*e+a,o=[s,r];t.categoryPositions.push([o,n[1]])})})}(t)}generateAxis(){let t=this;t.ctx.save(),t.ctx.strokeStyle="#666",t.ctx.lineWidth=1,t.ctx.translate(...f.axis.basePoint),t.ctx.moveTo(f.axis.x.line.length,0),t.ctx.lineTo(0,0),t.ctx.lineTo(0,0-f.axis.y.line.length),t.ctx.stroke(),t.ctx.restore(),function(){t.ctx.save();let e=f.axis.x.line.markPoint,n=f.axis.y.line.markPoint;t.ctx.strokeStyle="#666",t.ctx.lineWidth=1,t.ctx.lineCap="square",t.ctx.translate(...f.axis.basePoint),e.forEach((e,n)=>{t.ctx.moveTo(...e),t.ctx.lineTo(e[0],5)}),t.ctx.stroke(),n.forEach((e,n)=>{t.ctx.moveTo(...e),t.ctx.lineTo(-5,e[1])}),t.ctx.stroke(),t.ctx.restore()}(),function(){let e=f.axis.y.line.dashedLine;t.ctx.save(),t.ctx.translate(...f.axis.basePoint),t.ctx.strokeStyle="#ccc",t.ctx.lineWidth=1,e.forEach((e,n)=>{t.ctx.moveTo(...e[0]),t.ctx.lineTo(...e[1])}),t.ctx.stroke(),t.ctx.restore()}(),function(){let e=f.axis.x.text,n=f.axis.y.text;t.ctx.save(),t.ctx.translate(...f.axis.basePoint),t.ctx.fillStyle="#666",t.ctx.textAlign="center",t.ctx.font="18px sans-serif",e.forEach(e=>t.ctx.fillText(...e)),t.ctx.textAlign="right",n.forEach(e=>t.ctx.fillText(...e)),t.ctx.restore()}()}generateLines(){this.data.forEach(t=>{let e=$(`<canvas width="${x}" height="${g}"></canvas>`);this.$container.appendChild(e),t.element=e,function(t,e){let n=t.getContext("2d");n.save(),n.translate(...f.axis.basePoint),n.strokeStyle=e.lineColor,n.fillStyle="white",e.chunkPositions.forEach((t,e)=>{n.lineTo(...t),0!==e&&(n.moveTo(...t),n.arc(...t,5,0,2*Math.PI,!0)),n.moveTo(...t)}),n.stroke(),n.fill()}(e,t)},this)}generateCategory(t){let e,n=this,a=f.category.colorBoxWidth;if(t)(e=t.getContext("2d")).clearRect(0,0,x,g);else{let t=$(`<canvas class="category" width="${x}" height="${g}"></canvas>`);n.$container.appendChild(t),n.$categoryCanvas=t,e=t.getContext("2d")}e.save(),e.translate(...f.category.basePoint),e.fillStyle="#333",e.font="16px sans-serif",e.strokeStyle="black",e.strokeWidth=1,e.textBaseline="top",n.data.forEach((t,n)=>{"hide"!==t.element.className&&t.categoryPositions.forEach((t,n)=>{0===n?(e.save(),e.fillStyle=t[1],e.fillRect(...t[0],a,a),e.restore()):e.fillText(t[1],...t[0])})}),e.restore()}showSingleLine(t){let e=t.category.sort().toString();this.data.forEach(t=>{let n=t.category.sort().toString();t.element.className=n===e?"":"hide"}),this.generateCategory(this.$categoryCanvas)}showAllLine(){this.data.forEach(t=>{t.element.className=""}),this.generateCategory(this.$categoryCanvas)}}function $(t){let e=document.createElement("div");return e.innerHTML=t,e.children[0]}function b(t,e){if(t){if(t.tagName!==e){return b(t.parentNode,e)}return t}}!function(){let t=new s(JSON.stringify(a)),e=new l(".check-box"),n=new c(".table-box"),i=new u(".bar"),r=new m(".line");e.render(t.getOptionsData()),e.watch("changed",e=>{let a=e.getChosenOptionsData(),i=t.searchData(a);n.render(i)}),n.watch("rendered",t=>{let e=t.getTableData();r.render(e),i.render(e[0])}),n.watch("mouseover",t=>{if(b(t.target,"TBODY")){let e=b(t.target,"TR");if(e){let t=n.getRowData(e);t&&(i.render(t),r.showSingleLine(t))}}}),n.watch("mouseout",t=>{b(t.target,"TBODY")&&r.showAllLine()}),n.watch("changed",(e,n)=>{let a=n.getTableData();t.updateData(e),i.render(e),r.render(a)})}()},function(t,e){}]);